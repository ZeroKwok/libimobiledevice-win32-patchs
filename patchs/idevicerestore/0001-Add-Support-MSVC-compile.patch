From 28dd01d4ca83b739a88ed6a38f61701bbffe162d Mon Sep 17 00:00:00 2001
From: zero <zero.kwok@foxmail.com>
Date: Thu, 16 May 2024 10:51:28 +0800
Subject: [PATCH] Add Support MSVC compile

---
 src/fls.c | 7 +++++++
 src/fls.h | 4 ++--
 src/mbn.c | 2 +-
 3 files changed, 10 insertions(+), 3 deletions(-)

diff --git a/src/fls.c b/src/fls.c
index f422447..e5107f0 100644
--- a/src/fls.c
+++ b/src/fls.c
@@ -28,6 +28,10 @@
 #define offsetof(type, member)  __builtin_offsetof (type, member)
 #endif
 
+#ifndef void
+#define void char
+#endif
+
 static void fls_parse_elements(fls_file* fls)
 {
 	/* FIXME: the following code is not big endian safe */
@@ -336,3 +340,6 @@ int fls_insert_ticket(fls_file* fls, const unsigned char* data, unsigned int siz
 	return 0;
 }
 
+#ifdef void
+#undef void
+#endif
\ No newline at end of file
diff --git a/src/fls.h b/src/fls.h
index 57b3869..0532221 100644
--- a/src/fls.h
+++ b/src/fls.h
@@ -68,12 +68,12 @@ struct _fls_14_element {
 } __attribute__((packed));
 typedef struct _fls_14_element fls_14_element;
 
-typedef struct {
+typedef struct _fls_file {
 	unsigned int num_elements;
 	unsigned int max_elements;
 	fls_element** elements;
 	const fls_0c_element* c_element;
-	void* data;
+	char* data;
 	uint32_t size;
 } fls_file;
 
diff --git a/src/mbn.c b/src/mbn.c
index 101e29f..7a7adc9 100644
--- a/src/mbn.c
+++ b/src/mbn.c
@@ -84,7 +84,7 @@ int mbn_update_sig_blob(mbn_file* mbn, const unsigned char* sigdata, unsigned in
 		return -1;
 	}
 
-	memcpy(mbn->data + mbn->parsed_sig_offset, sigdata, siglen);
+	memcpy((char*)mbn->data + mbn->parsed_sig_offset, sigdata, siglen);
 
 	return 0;
 }
-- 
2.44.0.windows.1

